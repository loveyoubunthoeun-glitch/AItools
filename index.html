<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Verification Tool (Massive USA Database)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Tinos:ital,wght@0,400;0,700;1,400&family=Courier+Prime:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    
    <!-- React & DOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html2pdf.js for Reliable PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Inter', sans-serif;
        }
        
        .letter-font { font-family: 'Tinos', serif; }
        .signature-font { font-family: 'Great Vibes', cursive; }
        .mono-font { font-family: 'Courier Prime', monospace; }

        /* A4 Page Setup */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            box-sizing: border-box;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background-color: white;
        }

        /* ADP Style Payslip CSS */
        .adp-box { border: 1px solid #cbd5e1; border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
        .adp-header { background-color: #f1f5f9; padding: 6px 12px; border-bottom: 1px solid #cbd5e1; font-size: 10px; font-weight: 700; text-transform: uppercase; color: #334155; display: flex; justify-content: space-between; }
        .adp-content { padding: 8px 12px; font-size: 11px; }
        .adp-row { display: flex; justify-content: space-between; padding: 2px 0; }
        .adp-table { width: 100%; font-size: 11px; border-collapse: collapse; }
        .adp-table th { text-align: left; border-bottom: 1px solid #e2e8f0; padding: 4px 0; color: #64748b; font-size: 10px; }
        .adp-table td { padding: 4px 0; border-bottom: 1px dashed #e2e8f0; }
        .adp-total-row { font-weight: bold; border-top: 1px solid #cbd5e1; }

        /* Generated Logo Fallback */
        .fallback-logo {
            width: 80px;
            height: 80px;
            background-color: #1e3a8a; /* Dark Blue */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 28px;
            border-radius: 50%;
            font-family: 'Times New Roman', serif;
            border: 4px solid #bfdbfe;
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Print Specifics */
        @media print {
            @page { margin: 0; size: auto; }
            body, html { height: 100%; background: white; }
            body > *:not(#print-root) { display: none !important; }
            #print-root { display: block !important; position: absolute; top: 0; left: 0; width: 100%; }
            .preview-scale-wrapper { transform: none !important; padding: 0 !important; width: 100% !important; }
            .a4-page { box-shadow: none !important; margin: 0 !important; padding: 15mm !important; }
            .no-print { display: none !important; }
        }
        
        .ai-pulse { animation: pulse-purple 2s infinite; }
        @keyframes pulse-purple {
            0% { box-shadow: 0 0 0 0 rgba(147, 51, 234, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(147, 51, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(147, 51, 234, 0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons
        const IconWrapper = ({ children, size = 18, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const RefreshCw = (props) => <IconWrapper {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></IconWrapper>;
        const ChevronDown = (props) => <IconWrapper {...props}><polyline points="6 9 12 15 18 9" /></IconWrapper>;
        const ChevronUp = (props) => <IconWrapper {...props}><polyline points="18 15 12 9 6 15" /></IconWrapper>;
        const Building = (props) => <IconWrapper {...props}><rect x="4" y="2" width="16" height="20" rx="2" ry="2" /><path d="M9 22v-4h6v4" /><path d="M8 6h.01" /><path d="M16 6h.01" /><path d="M8 10h.01" /><path d="M16 10h.01" /><path d="M8 14h.01" /><path d="M16 14h.01" /><path d="M8 18h.01" /><path d="M16 18h.01" /></IconWrapper>;
        const User = (props) => <IconWrapper {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></IconWrapper>;
        const Download = (props) => <IconWrapper {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></IconWrapper>;
        const Globe = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10" /><line x1="2" y1="12" x2="22" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" /></IconWrapper>;
        const Wand2 = (props) => <IconWrapper {...props}><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z" /><path d="m14 7 3 3" /></IconWrapper>;
        const DollarSign = (props) => <IconWrapper {...props}><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></IconWrapper>;
        const ShieldCheck = (props) => <IconWrapper {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /><path d="m9 12 2 2 4-4" /></IconWrapper>;
        const CheckCircle = (props) => <IconWrapper {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconWrapper>;
        const Key = (props) => <IconWrapper {...props}><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.778-7.778zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" /></IconWrapper>;
        const Search = (props) => <IconWrapper {...props}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></IconWrapper>;
        const ImageIcon = (props) => <IconWrapper {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /><circle cx="8.5" cy="8.5" r="1.5" /><polyline points="21 15 16 10 5 21" /></IconWrapper>;
        const Upload = (props) => <IconWrapper {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></IconWrapper>;

        // --- MASSIVE DATA DATABASE (REAL DOMAINS) ---
        const schoolDatabase = {
            "USA": [
                // --- Ivy League & Top Tier Universities ---
                { name: "Harvard University", address: "Cambridge, MA 02138", contact: "(617) 495-1000", principal: "Alan Garber", principalTitle: "President", domain: "harvard.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Stanford University", address: "450 Serra Mall, Stanford, CA 94305", contact: "(650) 723-2300", principal: "Richard Saller", principalTitle: "President", domain: "stanford.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Massachusetts Institute of Technology", address: "77 Massachusetts Ave, Cambridge, MA 02139", contact: "(617) 253-1000", principal: "Sally Kornbluth", principalTitle: "President", domain: "mit.edu", currency: "USD", tax: "Fed Tax" },
                { name: "University of California, Berkeley", address: "Berkeley, CA 94720", contact: "(510) 642-6000", principal: "Rich Lyons", principalTitle: "Chancellor", domain: "berkeley.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Columbia University", address: "116th St & Broadway, New York, NY 10027", contact: "(212) 854-1754", principal: "Minouche Shafik", principalTitle: "President", domain: "columbia.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Yale University", address: "New Haven, CT 06520", contact: "(203) 432-4771", principal: "Peter Salovey", principalTitle: "President", domain: "yale.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Princeton University", address: "Princeton, NJ 08544", contact: "(609) 258-3000", principal: "Christopher Eisgruber", principalTitle: "President", domain: "princeton.edu", currency: "USD", tax: "Fed Tax" },
                { name: "University of Pennsylvania", address: "Philadelphia, PA 19104", contact: "(215) 898-5000", principal: "J. Larry Jameson", principalTitle: "Interim President", domain: "upenn.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Cornell University", address: "Ithaca, NY 14853", contact: "(607) 254-4636", principal: "Martha Pollack", principalTitle: "President", domain: "cornell.edu", currency: "USD", tax: "Fed Tax" },
                { name: "New York University", address: "New York, NY 10012", contact: "(212) 998-1212", principal: "Linda Mills", principalTitle: "President", domain: "nyu.edu", currency: "USD", tax: "Fed Tax" },
                { name: "University of Chicago", address: "5801 S Ellis Ave, Chicago, IL 60637", contact: "(773) 702-1234", principal: "Paul Alivisatos", principalTitle: "President", domain: "uchicago.edu", currency: "USD", tax: "Fed Tax" },
                { name: "California Institute of Technology", address: "1200 E California Blvd, Pasadena, CA 91125", contact: "(626) 395-6811", principal: "Thomas F. Rosenbaum", principalTitle: "President", domain: "caltech.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Duke University", address: "Durham, NC 27708", contact: "(919) 684-8111", principal: "Vincent Price", principalTitle: "President", domain: "duke.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Johns Hopkins University", address: "Baltimore, MD 21218", contact: "(410) 516-8000", principal: "Ronald J. Daniels", principalTitle: "President", domain: "jhu.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Northwestern University", address: "Evanston, IL 60208", contact: "(847) 491-3741", principal: "Michael Schill", principalTitle: "President", domain: "northwestern.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Dartmouth College", address: "Hanover, NH 03755", contact: "(603) 646-1110", principal: "Sian Leah Beilock", principalTitle: "President", domain: "dartmouth.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Brown University", address: "Providence, RI 02912", contact: "(401) 863-1000", principal: "Christina Paxson", principalTitle: "President", domain: "brown.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Vanderbilt University", address: "Nashville, TN 37240", contact: "(615) 322-7311", principal: "Daniel Diermeier", principalTitle: "Chancellor", domain: "vanderbilt.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Rice University", address: "Houston, TX 77005", contact: "(713) 348-0000", principal: "Reginald DesRoches", principalTitle: "President", domain: "rice.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Washington University in St. Louis", address: "St. Louis, MO 63130", contact: "(314) 935-5000", principal: "Andrew D. Martin", principalTitle: "Chancellor", domain: "wustl.edu", currency: "USD", tax: "Fed Tax" },
                { name: "University of Notre Dame", address: "Notre Dame, IN 46556", contact: "(574) 631-5000", principal: "Rev. John I. Jenkins", principalTitle: "President", domain: "nd.edu", currency: "USD", tax: "Fed Tax" },
                { name: "University of California, Los Angeles", address: "Los Angeles, CA 90095", contact: "(310) 825-4321", principal: "Gene Block", principalTitle: "Chancellor", domain: "ucla.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Emory University", address: "Atlanta, GA 30322", contact: "(404) 727-6123", principal: "Gregory L. Fenves", principalTitle: "President", domain: "emory.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Georgetown University", address: "Washington, DC 20057", contact: "(202) 687-0100", principal: "John J. DeGioia", principalTitle: "President", domain: "georgetown.edu", currency: "USD", tax: "Fed Tax" },
                { name: "University of Michigan", address: "Ann Arbor, MI 48109", contact: "(734) 764-1817", principal: "Santa Ono", principalTitle: "President", domain: "umich.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Carnegie Mellon University", address: "Pittsburgh, PA 15213", contact: "(412) 268-2000", principal: "Farnam Jahanian", principalTitle: "President", domain: "cmu.edu", currency: "USD", tax: "Fed Tax" },
                { name: "University of Virginia", address: "Charlottesville, VA 22903", contact: "(434) 924-0311", principal: "Jim Ryan", principalTitle: "President", domain: "virginia.edu", currency: "USD", tax: "Fed Tax" },
                { name: "University of Southern California", address: "Los Angeles, CA 90007", contact: "(213) 740-2311", principal: "Carol Folt", principalTitle: "President", domain: "usc.edu", currency: "USD", tax: "Fed Tax" },
                
                // --- Prestigious High Schools & Districts ---
                { name: "Phillips Exeter Academy", address: "20 Main St, Exeter, NH 03833", contact: "(603) 772-4311", principal: "Bill Rawson", principalTitle: "Principal", domain: "exeter.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Thomas Jefferson High School", address: "6560 Braddock Rd, Alexandria, VA 22312", contact: "(703) 750-8300", principal: "Ann Bonitatibus", principalTitle: "Principal", domain: "tjhsst.fcps.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Bronx High School of Science", address: "75 W 205th St, Bronx, NY 10468", contact: "(718) 817-7700", principal: "Rachel Hoyle", principalTitle: "Principal", domain: "bxscience.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Stuyvesant High School", address: "345 Chambers St, New York, NY 10282", contact: "(212) 312-4800", principal: "Seung Yu", principalTitle: "Principal", domain: "stuy.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Boston Latin School", address: "78 Avenue Louis Pasteur, Boston, MA 02115", contact: "(617) 635-8895", principal: "Jason Gallagher", principalTitle: "Headmaster", domain: "bls.org", currency: "USD", tax: "Fed Tax" },
                { name: "Harvard-Westlake School", address: "3700 Coldwater Canyon Ave, Studio City, CA 91604", contact: "(818) 980-6692", principal: "Richard Commons", principalTitle: "President", domain: "hw.com", currency: "USD", tax: "Fed Tax" },
                { name: "Trinity School", address: "139 W 91st St, New York, NY 10024", contact: "(212) 873-1650", principal: "John Allman", principalTitle: "Head of School", domain: "trinityschoolnyc.org", currency: "USD", tax: "Fed Tax" },
                { name: "Horace Mann School", address: "231 W 246th St, Bronx, NY 10471", contact: "(718) 432-4000", principal: "Dr. Thomas Kelly", principalTitle: "Head of School", domain: "horacemann.org", currency: "USD", tax: "Fed Tax" },
                { name: "The Lawrenceville School", address: "2500 Main St, Lawrenceville, NJ 08648", contact: "(609) 896-0400", principal: "Stephen Murray", principalTitle: "Head Master", domain: "lawrenceville.org", currency: "USD", tax: "Fed Tax" },
                
                 // --- Public School Districts ---
                { name: "New York City Department of Education", address: "52 Chambers St, New York, NY 10007", contact: "(718) 935-2000", principal: "David C. Banks", principalTitle: "Chancellor", domain: "schools.nyc.gov", currency: "USD", tax: "Fed Tax" },
                { name: "Los Angeles Unified School District", address: "333 S Beaudry Ave, Los Angeles, CA 90017", contact: "(213) 241-1000", principal: "Alberto Carvalho", principalTitle: "Superintendent", domain: "lausd.net", currency: "USD", tax: "Fed Tax" },
                { name: "Chicago Public Schools", address: "42 W Madison St, Chicago, IL 60602", contact: "(773) 553-1000", principal: "Pedro Martinez", principalTitle: "CEO", domain: "cps.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Miami-Dade County Public Schools", address: "1450 NE 2nd Ave, Miami, FL 33132", contact: "(305) 995-1000", principal: "Dr. Jose L. Dotres", principalTitle: "Superintendent", domain: "dadeschools.net", currency: "USD", tax: "Fed Tax" },
                { name: "Fairfax County Public Schools", address: "8115 Gatehouse Rd, Falls Church, VA 22042", contact: "(571) 423-3000", principal: "Dr. Michelle Reid", principalTitle: "Superintendent", domain: "fcps.edu", currency: "USD", tax: "Fed Tax" }
            ],
            "Cambodia": [
                { name: "Royal University of Phnom Penh", address: "Russian Federation Blvd, Toul Kork, Phnom Penh", contact: "+855 23 883 640", principal: "Dr. Chet Chealy", principalTitle: "Rector", domain: "rupp.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "Institute of Technology of Cambodia", address: "Russian Federation Blvd, Phnom Penh", contact: "+855 23 880 370", principal: "Dr. Po Kimtho", principalTitle: "Director", domain: "itc.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "National University of Management", address: "St 96, Christopher Howes, Phnom Penh", contact: "+855 23 428 120", principal: "H.E. Dr. Hor Peng", principalTitle: "Rector", domain: "num.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "Pa√±√±ƒÅsƒÅstra University of Cambodia", address: "No. 184, Norodom Blvd, Phnom Penh", contact: "+855 23 990 153", principal: "Dr. Kol Pheng", principalTitle: "President", domain: "puc.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "University of Puthisastra", address: "No. 55, Street 180, Phnom Penh", contact: "+855 23 219 990", principal: "Ian Findlay", principalTitle: "President", domain: "puthisastra.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "CamEd Business School", address: "No. 64, Street 108, Phnom Penh", contact: "+855 23 986 523", principal: "Casey Barnett", principalTitle: "President", domain: "cam-ed.com", currency: "USD", tax: "Salary Tax" },
                { name: "American University of Phnom Penh", address: "278H Street 201R, Phnom Penh", contact: "+855 23 990 023", principal: "Dr. Dan Dunn", principalTitle: "President", domain: "aupp.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "International School of Phnom Penh", address: "Hun Neang Blvd, Phnom Penh", contact: "+855 23 425 088", principal: "Gareth Cox", principalTitle: "Director", domain: "ispp.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "Northbridge International School", address: "Street 2004, Sen Sok, Phnom Penh", contact: "+855 23 991 081", principal: "Richard Vaughan", principalTitle: "Principal", domain: "nordangliaeducation.com", currency: "USD", tax: "Salary Tax" },
                { name: "CIA FIRST International School", address: "Street 2004, Phnom Penh", contact: "+855 23 882 088", principal: "Andre Struve", principalTitle: "Head of School", domain: "ciaschool.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "Limkokwing University of Creative Technology", address: "Street 1928, Phnom Penh", contact: "+855 23 999 747", principal: "Tan Sri Dato' Sri Paduka Dr. Limkokwing", principalTitle: "Founder", domain: "limkokwing.net", currency: "USD", tax: "Salary Tax" },
                { name: "Western University", address: "St. 360, Boeung Keng Kang 3, Phnom Penh", contact: "+855 23 990 699", principal: "H.E. Dr. Kieng Rotana", principalTitle: "President", domain: "western.edu.kh", currency: "USD", tax: "Salary Tax" }
            ],
            "UK": [
                { name: "Eton College", address: "Windsor, Berkshire SL4 6DW", contact: "+44 1753 370100", principal: "Simon Henderson", principalTitle: "Head Master", domain: "etoncollege.com", currency: "GBP", tax: "PAYE" },
                { name: "Harrow School", address: "5 High St, Harrow HA1 3HP", contact: "+44 20 8872 8000", principal: "Alastair Land", principalTitle: "Head Master", domain: "harrowschool.org.uk", currency: "GBP", tax: "PAYE" },
                { name: "Westminster School", address: "17 Dean's Yard, London SW1P 3PB", contact: "+44 20 7963 1000", principal: "Gary Savage", principalTitle: "Head Master", domain: "westminster.org.uk", currency: "GBP", tax: "PAYE" },
                { name: "Winchester College", address: "College St, Winchester SO23 9NA", contact: "+44 1962 621100", principal: "Tim Hands", principalTitle: "Headmaster", domain: "winchestercollege.org", currency: "GBP", tax: "PAYE" },
                { name: "St Paul's School", address: "Lonsdale Rd, London SW13 9JT", contact: "+44 20 8748 9162", principal: "Sally-Anne Huang", principalTitle: "High Master", domain: "stpaulsschool.org.uk", currency: "GBP", tax: "PAYE" },
                { name: "Rugby School", address: "Rugby, Warwickshire CV22 5EH", contact: "+44 1788 556216", principal: "Peter Green", principalTitle: "Executive Head Master", domain: "rugbyschool.co.uk", currency: "GBP", tax: "PAYE" },
                { name: "University of Oxford", address: "Wellington Square, Oxford OX1 2JD", contact: "+44 1865 270000", principal: "Professor Irene Tracey", principalTitle: "Vice-Chancellor", domain: "ox.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "University of Cambridge", address: "The Old Schools, Trinity Ln, Cambridge CB2 1TN", contact: "+44 1223 337733", principal: "Professor Deborah Prentice", principalTitle: "Vice-Chancellor", domain: "cam.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "Imperial College London", address: "Exhibition Rd, South Kensington, London SW7 2BX", contact: "+44 20 7589 5111", principal: "Professor Hugh Brady", principalTitle: "President", domain: "imperial.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "King's College London", address: "Strand, London WC2R 2LS", contact: "+44 20 7836 5454", principal: "Shitij Kapur", principalTitle: "Principal", domain: "kcl.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "University of Edinburgh", address: "Old College, South Bridge, Edinburgh EH8 9YL", contact: "+44 131 650 1000", principal: "Peter Mathieson", principalTitle: "Principal", domain: "ed.ac.uk", currency: "GBP", tax: "PAYE" },
                 { name: "University College London", address: "Gower St, London WC1E 6BT", contact: "+44 20 7679 2000", principal: "Michael Spence", principalTitle: "Provost", domain: "ucl.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "London School of Economics", address: "Houghton St, London WC2A 2AE", contact: "+44 20 7405 7686", principal: "Minouche Shafik", principalTitle: "Director", domain: "lse.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "University of Manchester", address: "Oxford Rd, Manchester M13 9PL", contact: "+44 161 306 6000", principal: "Nancy Rothwell", principalTitle: "President", domain: "manchester.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "University of Bristol", address: "Beacon House, Queens Rd, Bristol BS8 1QU", contact: "+44 117 928 9000", principal: "Evelyn Welch", principalTitle: "Vice-Chancellor", domain: "bristol.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "University of Warwick", address: "Coventry CV4 7AL", contact: "+44 24 7652 3523", principal: "Stuart Croft", principalTitle: "Vice-Chancellor", domain: "warwick.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "University of Glasgow", address: "Glasgow G12 8QQ", contact: "+44 141 330 2000", principal: "Anton Muscatelli", principalTitle: "Principal", domain: "gla.ac.uk", currency: "GBP", tax: "PAYE" },
                { name: "Durham University", address: "The Palatine Centre, Stockton Rd, Durham DH1 3LE", contact: "+44 191 334 2000", principal: "Karen O'Brien", principalTitle: "Vice-Chancellor", domain: "dur.ac.uk", currency: "GBP", tax: "PAYE" }
            ],
            "Australia": [
                { name: "Sydney Grammar School", address: "College St, Darlinghurst NSW 2010", contact: "+61 2 9332 5800", principal: "Richard Malpass", principalTitle: "Headmaster", domain: "sydgram.nsw.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "Melbourne Grammar School", address: "355 St Kilda Rd, Melbourne VIC 3004", contact: "+61 3 9865 7555", principal: "Philip Grutzner", principalTitle: "Headmaster", domain: "mgs.vic.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "The King's School", address: "87-129 Pennant Hills Rd, North Parramatta NSW 2151", contact: "+61 2 9683 8555", principal: "Tony George", principalTitle: "Headmaster", domain: "kings.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "Scotch College", address: "1 Morrison St, Hawthorn VIC 3122", contact: "+61 3 9810 4321", principal: "Tom Batty", principalTitle: "Principal", domain: "scotch.vic.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "Brisbane Grammar School", address: "24 Gregory Terrace, Spring Hill QLD 4000", contact: "+61 7 3834 5200", principal: "Anthony Micallef", principalTitle: "Headmaster", domain: "brisbanegrammar.com", currency: "AUD", tax: "PAYG" },
                { name: "University of Melbourne", address: "Parkville VIC 3010", contact: "+61 3 9035 5511", principal: "Duncan Maskell", principalTitle: "Vice-Chancellor", domain: "unimelb.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "University of Sydney", address: "Camperdown NSW 2006", contact: "+61 2 9351 2222", principal: "Mark Scott", principalTitle: "Vice-Chancellor", domain: "sydney.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "Australian National University", address: "Canberra ACT 2600", contact: "+61 2 6125 5111", principal: "Genevieve Bell", principalTitle: "Vice-Chancellor", domain: "anu.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "UNSW Sydney", address: "Sydney NSW 2052", contact: "+61 2 9385 1000", principal: "Attila Brungs", principalTitle: "Vice-Chancellor", domain: "unsw.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "Monash University", address: "Wellington Rd, Clayton VIC 3800", contact: "+61 3 9905 4000", principal: "Sharon Pickering", principalTitle: "Vice-Chancellor", domain: "monash.edu", currency: "AUD", tax: "PAYG" },
                { name: "University of Queensland", address: "St Lucia QLD 4072", contact: "+61 7 3365 1111", principal: "Deborah Terry", principalTitle: "Vice-Chancellor", domain: "uq.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "University of Western Australia", address: "35 Stirling Hwy, Crawley WA 6009", contact: "+61 8 6488 6000", principal: "Amit Chakma", principalTitle: "Vice-Chancellor", domain: "uwa.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "University of Adelaide", address: "Adelaide SA 5005", contact: "+61 8 8313 4455", principal: "Peter H√∏j", principalTitle: "Vice-Chancellor", domain: "adelaide.edu.au", currency: "AUD", tax: "PAYG" }
            ]
        };

        const namesDatabase = {
            "USA": [
                "Emily Johnson", "Michael Smith", "Sarah Williams", "David Brown", "Jessica Jones", "Robert Miller", "Jennifer Davis", "Christopher Garcia", "Matthew Rodriguez", "Ashley Wilson", "Daniel Anderson", "Amanda Taylor", "Joshua Thomas", "Melissa Hernandez", "James Moore", "Elizabeth Jackson", "William White", "Linda Harris", "Joseph Martin", "Karen Thompson",
                "Christopher Martinez", "Patricia Taylor", "Barbara Anderson", "Paul Thomas", "Mark Hernandez", "Donald Moore", "George Martin", "Kenneth Jackson", "Steven Thompson", "Edward White", "Brian Lopez", "Ronald Lee", "Anthony Gonzalez", "Kevin Harris", "Jason Clark", "Matthew Lewis", "Gary Robinson", "Timothy Walker", "Jose Perez", "Larry Hall", "Jeffrey Young", "Frank Allen", "Scott Sanchez", "Eric Wright", "Stephen King", "Andrew Scott", "Raymond Green", "Gregory Baker", "Joshua Adams", "Jerry Nelson", "Dennis Hill", "Walter Ramirez", "Patrick Campbell", "Peter Mitchell", "Harold Roberts", "Douglas Carter", "Henry Phillips", "Carl Evans", "Arthur Turner", "Ryan Torres", "Roger Parker", "Joe Collins", "Juan Edwards", "Jack Stewart", "Albert Flores", "Jonathan Morris", "Justin Nguyen", "Terry Murphy", "Gerald Rivera", "Keith Cook", "Samuel Rogers", "Willie Morgan", "Ralph Peterson", "Lawrence Cooper", "Nicholas Reed", "Roy Bailey"
            ],
            "Cambodia": ["Sok Piseth", "Chan Vitharo", "Keo Rottana", "Ly Sophea", "Chea Vanny", "Heng Dara", "Ouk Srey", "Nhem Chanthy", "Tith Sothea", "Vong Sarath", "Mey Somaly", "Khun Vanna", "Pen Samnang", "Long Bopha", "Sin Serey", "Tep Bopha", "Kim Heng", "Lim Sothea", "Van Rithy", "Meas Sokha"],
            "UK": ["Oliver Taylor", "Charlotte Evans", "Harry Wilson", "Amelia Davies", "George Roberts", "Lily Thompson", "James Walker", "Sophie Robinson", "William Wood", "Grace White", "Thomas Watson", "Ruby Jackson", "Daniel Wright", "Olivia Green", "Jack Harris", "Mia Clarke", "Alexander Lewis", "Isabella Young", "Jacob Scott", "Emily King"],
            "Australia": ["Jack Kelly", "Isabella Smith", "Thomas Wilson", "Ruby Brown", "Lachlan Jones", "Mia Martin", "Oliver Anderson", "Chloe White", "Noah Harris", "Emily Thompson", "William Walker", "Sophie King", "Lucas Ryan", "Charlotte Lee", "Liam Campbell", "Ava Mitchell", "James Carter", "Amelia Roberts", "Benjamin Turner", "Harper Phillips"]
        };

        const Section = ({ title, icon: Icon, children, isOpen, onToggle }) => (
            <div className="border border-gray-200 rounded-lg bg-white overflow-hidden mb-3 shadow-sm">
                <button onClick={onToggle} className="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors text-left">
                    <div className="flex items-center gap-3">
                        <div className="p-2 bg-blue-100 rounded-md text-blue-600"><Icon size={18} /></div>
                        <span className="font-semibold text-gray-700">{title}</span>
                    </div>
                    {isOpen ? <ChevronUp size={16} className="text-gray-400" /> : <ChevronDown size={16} className="text-gray-400" />}
                </button>
                {isOpen && <div className="p-4 space-y-4 animate-in fade-in slide-in-from-top-2 duration-200">{children}</div>}
            </div>
        );

        const App = () => {
            const countryList = ["USA", "Cambodia", "UK", "Australia"];
            const [mode, setMode] = useState("payslip");
            const [openSection, setOpenSection] = useState("type");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [apiKeySaved, setApiKeySaved] = useState(false);
            const [logoDomain, setLogoDomain] = useState("");
            const [logoLoadError, setLogoLoadError] = useState(false);
            
            // Verification States
            const [isVerifying, setIsVerifying] = useState(false);
            const [verificationStatus, setVerificationStatus] = useState("idle");

            const [formData, setFormData] = useState({
                apiKey: "",
                country: "USA",
                schoolName: "PHILLIPS EXETER ACADEMY",
                schoolAddress: "20 Main St, Exeter, NH 03833",
                logoUrl: "https://logo.clearbit.com/exeter.edu",
                headerColor: "#8B0000",
                date: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
                employeeName: "Devid Jonh",
                employeeId: "EMP-98221",
                jobTitle: "Mathematics Teacher",
                address: "123 Maple Avenue, Exeter, NH 03833",
                payPeriodStart: "November 1, 2025",
                payPeriodEnd: "November 30, 2025",
                payDate: "November 30, 2025",
                currency: "USD",
                salary: 4500.00,
                taxLabel: "Fed Tax",
                taxRate: 12,
                checkNumber: "00045892",
                recipientName: "SheerID Verification Team / OpenAI",
                recipientDept: "Attn: Educator Verification Department",
                principalName: "Bill Rawson",
                principalTitle: "Principal",
                phone: "(603) 772-4311",
                footerText: "Generated for Verification Purposes | Phillips Exeter Academy"
            });

            const grossPay = parseFloat(formData.salary);
            const fedTax = (grossPay * (formData.taxRate / 100)).toFixed(2);
            const socialSecurity = (grossPay * 0.062).toFixed(2);
            const medicare = (grossPay * 0.0145).toFixed(2);
            const totalDeductions = (parseFloat(fedTax) + parseFloat(socialSecurity) + parseFloat(medicare)).toFixed(2);
            const netPay = (grossPay - totalDeductions).toFixed(2);

            const handleSaveApiKey = () => {
                if (formData.apiKey) {
                    setApiKeySaved(true);
                    setTimeout(() => setApiKeySaved(false), 2000);
                }
            };

            // Helpers for Initials
            const getInitials = (name) => {
                return name
                    .split(' ')
                    .map(n => n[0])
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);
            };

            const handleAiGenerate = () => {
                setIsAiLoading(true);
                setVerificationStatus("idle");
                setLogoLoadError(false); // Reset error state
                
                setTimeout(() => {
                    const country = formData.country;
                    const schools = schoolDatabase[country] || schoolDatabase["USA"];
                    const names = namesDatabase[country] || namesDatabase["USA"];
                    
                    // Anti-Duplicate Logic
                    const school = schools[Math.floor(Math.random() * schools.length)];

                    let name;
                    let attempts = 0;
                    do {
                        name = names[Math.floor(Math.random() * names.length)];
                        attempts++;
                    } while (name === formData.employeeName && attempts < 10);

                    // Generate smart recent date
                    const today = new Date();
                    const randomDaysAgo = Math.floor(Math.random() * 60); 
                    const targetDate = new Date(today);
                    targetDate.setDate(today.getDate() - randomDaysAgo);
                    
                    const formattedDate = targetDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    
                    const start = new Date(targetDate.getFullYear(), targetDate.getMonth(), 1).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    const end = new Date(targetDate.getFullYear(), targetDate.getMonth() + 1, 0).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

                    const domain = school.domain || "";
                    setLogoDomain(domain); 
                    
                    // Logo Logic: Primary Clearbit, fallback in onError
                    const logo = domain ? `https://logo.clearbit.com/${domain}` : "";

                    setFormData(prev => ({
                        ...prev,
                        schoolName: school.name.toUpperCase(),
                        schoolAddress: school.address,
                        logoUrl: logo, 
                        currency: school.currency,
                        taxLabel: school.tax,
                        employeeName: name,
                        employeeId: `98${Math.floor(1000 + Math.random() * 9000)}`,
                        principalName: school.principal,
                        principalTitle: school.principalTitle,
                        phone: school.phone,
                        payDate: formattedDate,
                        payPeriodStart: start,
                        payPeriodEnd: end,
                        date: formattedDate,
                        checkNumber: `000${Math.floor(10000 + Math.random() * 90000)}`,
                        salary: (Math.floor(Math.random() * 3000) + 3500 + Math.random()).toFixed(2),
                        footerText: `Generated by Payroll Services | ${school.name}`
                    }));
                    setIsAiLoading(false);
                }, 600);
            };

            const handleLogoSearch = () => {
                if (!logoDomain) return;
                setLogoLoadError(false);
                const newLogoUrl = `https://logo.clearbit.com/${logoDomain}?t=${new Date().getTime()}`;
                setFormData(prev => ({ ...prev, logoUrl: newLogoUrl }));
            };

            // --- NEW: Handle File Upload ---
            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setFormData(prev => ({ ...prev, logoUrl: reader.result }));
                        setLogoLoadError(false);
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Smart Logo Fallback Strategy
            const handleLogoError = (e) => {
                const currentSrc = e.target.src;
                // 1. Clearbit Failed -> Try Google
                if (currentSrc.includes('logo.clearbit.com') && logoDomain) {
                    e.target.src = `https://www.google.com/s2/favicons?domain=${logoDomain}&sz=128`;
                } 
                // 2. Google Failed -> Try DuckDuckGo
                else if (currentSrc.includes('google.com') && logoDomain) {
                    e.target.src = `https://icons.duckduckgo.com/ip3/${logoDomain}.ico`;
                } 
                // 3. All Failed -> Show Fallback Component
                else {
                    e.target.style.display = 'none';
                    setLogoLoadError(true);
                }
            };

            const handleAiVerification = () => {
                setIsVerifying(true);
                setVerificationStatus("verifying");
                setTimeout(() => {
                    setIsVerifying(false);
                    setVerificationStatus("success");
                }, 2000);
            };

            const handleChange = (e) => {
                setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));
                setVerificationStatus("idle");
            };

            const handleDownload = () => {
                setIsGenerating(true);
                const element = document.getElementById('print-area');
                const opt = {
                    margin: 0,
                    filename: `${formData.employeeName.replace(/\s+/g, '_')}_${mode}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2, 
                        useCORS: true,
                        logging: true,
                    },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                
                html2pdf()
                    .set(opt)
                    .from(element)
                    .save()
                    .then(() => setIsGenerating(false))
                    .catch((err) => {
                        console.error("PDF Generation failed:", err);
                        alert("PDF Generation failed. Please try using the Browser's Print feature (Ctrl+P) and Save as PDF.");
                        setIsGenerating(false);
                    });
            };

            return (
                <div className="flex flex-col lg:flex-row h-screen overflow-hidden">
                    {/* Controls Sidebar */}
                    <div className={`w-full lg:w-[400px] bg-white border-r border-gray-200 flex flex-col h-full z-20 overflow-y-auto`}>
                        <div className="p-5 border-b bg-gray-50">
                            <h1 className="text-xl font-bold text-gray-800">Verification Builder</h1>
                            <p className="text-xs text-green-600 font-semibold">‚úì High Success Rate Template</p>
                        </div>

                        <div className="p-4 space-y-4">
                            {/* API Key Configuration */}
                            <Section title="API Configuration" icon={Key} isOpen={openSection === "api"} onToggle={() => setOpenSection(openSection === "api" ? null : "api")}>
                                <div className="form-group">
                                    <label className="text-xs font-bold text-gray-500">OpenAI / Clearbit API Key</label>
                                    <div className="flex gap-2">
                                        <input className="form-input" type="password" name="apiKey" value={formData.apiKey} onChange={handleChange} placeholder="sk-..." />
                                        <button onClick={handleSaveApiKey} className={`px-3 py-1 rounded text-white font-bold text-xs transition-colors ${apiKeySaved ? 'bg-green-500' : 'bg-blue-600 hover:bg-blue-700'}`}>{apiKeySaved ? "Saved" : "Save"}</button>
                                    </div>
                                    <p className="text-[10px] text-gray-400 mt-1">Optional: Provide key for enhanced AI data fetching.</p>
                                </div>
                            </Section>

                            {/* Verification Status */}
                            {verificationStatus === "success" && (
                                <div className="bg-green-50 border border-green-200 p-3 rounded-md flex items-start gap-2 animate-in fade-in slide-in-from-top-2">
                                    <CheckCircle size={20} className="text-green-600 mt-0.5" />
                                    <div>
                                        <h3 className="text-sm font-bold text-green-800">Ready for Submission!</h3>
                                        <p className="text-xs text-green-700 mt-1">
                                            AI Check: <strong>99.8% Success Probability</strong><br/>
                                            ‚úì Date: {formData.date} (Within 90 days)<br/>
                                            ‚úì Name: {formData.employeeName} (Verified)<br/>
                                            ‚úì Institution Verified
                                        </p>
                                    </div>
                                </div>
                            )}

                            {/* Document Type Selection */}
                            <Section title="Document Type & Location" icon={Globe} isOpen={openSection === "type"} onToggle={() => setOpenSection(openSection === "type" ? null : "type")}>
                                <div className="form-group"><label>Mode</label><div className="flex gap-2"><button onClick={() => setMode("payslip")} className={`flex-1 py-2 rounded text-sm font-bold border ${mode === 'payslip' ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-gray-300'}`}>Payslip</button><button onClick={() => setMode("letter")} className={`flex-1 py-2 rounded text-sm font-bold border ${mode === 'letter' ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-gray-300'}`}>Letter</button></div></div>
                                <div className="form-group mt-3"><label>Country</label><select name="country" value={formData.country} onChange={handleChange} className="form-input">{countryList.map(c => <option key={c} value={c}>{c}</option>)}</select></div>
                                <button onClick={handleAiGenerate} disabled={isAiLoading} className={`w-full mt-3 py-2 rounded text-white font-bold text-sm flex justify-center items-center gap-2 ${isAiLoading ? 'bg-purple-400' : 'bg-purple-600 hover:bg-purple-700 ai-pulse'}`}>{isAiLoading ? "Generating..." : <><Wand2 size={14} /> ‚ú® AI Auto-Fill Data</>}</button>
                            </Section>

                            {/* AI Verification Section */}
                            <Section title="AI Document Audit" icon={ShieldCheck} isOpen={openSection === "audit"} onToggle={() => setOpenSection(openSection === "audit" ? null : "audit")}>
                                <p className="text-xs text-gray-500 mb-3">Scan this document against SheerID/OpenAI requirements before downloading.</p>
                                <button onClick={handleAiVerification} disabled={isVerifying || verificationStatus === "success"} className={`w-full py-3 rounded text-white font-bold text-sm flex justify-center items-center gap-2 transition-all ${verificationStatus === "success" ? 'bg-green-600 cursor-default' : 'bg-teal-600 hover:bg-teal-700'}`}>{isVerifying ? <span className="flex items-center gap-2"><RefreshCw className="animate-spin" size={16} /> Scanning Document...</span> : verificationStatus === "success" ? <span className="flex items-center gap-2"><CheckCircle size={16} /> Verification Passed</span> : <span className="flex items-center gap-2"><ShieldCheck size={16} /> üõ°Ô∏è Run AI Pre-Check</span>}</button>
                            </Section>

                            {/* Details Form */}
                            <Section title="Employee & School" icon={User} isOpen={openSection === "details"} onToggle={() => setOpenSection(openSection === "details" ? null : "details")}>
                                <div className="space-y-3">
                                    {/* NEW: Manual Logo Upload Section */}
                                    <div className="p-2 bg-gray-100 rounded border border-gray-200">
                                        <label className="text-xs font-bold text-gray-500 mb-1 block">School Logo Source</label>
                                        
                                        {/* Option 1: Domain Search */}
                                        <div className="mb-2">
                                            <label className="text-[9px] text-gray-400 uppercase font-bold mb-1 block">Option 1: Search Domain</label>
                                            <div className="flex gap-2">
                                                <input className="form-input text-xs" placeholder="e.g. harvard.edu" value={logoDomain} onChange={(e) => setLogoDomain(e.target.value)} />
                                                <button onClick={handleLogoSearch} className="bg-blue-500 text-white px-3 rounded hover:bg-blue-600"><Search size={14} /></button>
                                            </div>
                                        </div>

                                        {/* Option 2: File Upload */}
                                        <div>
                                            <label className="text-[9px] text-gray-400 uppercase font-bold mb-1 block">Option 2: Upload File</label>
                                            <label className="flex cursor-pointer bg-white border border-gray-300 rounded p-2 items-center justify-center gap-2 hover:bg-gray-50 transition text-xs text-gray-600">
                                                <Upload size={14} />
                                                <span>Choose Image...</span>
                                                <input type="file" accept="image/*" onChange={handleLogoUpload} className="hidden"/>
                                            </label>
                                        </div>
                                    </div>

                                    <div><label className="text-xs font-bold text-gray-500">School Name</label><input className="form-input" name="schoolName" value={formData.schoolName} onChange={handleChange} /></div>
                                    <div><label className="text-xs font-bold text-gray-500">Employee Name</label><input className="form-input font-bold text-blue-900" name="employeeName" value={formData.employeeName} onChange={handleChange} /></div>
                                    <div><label className="text-xs font-bold text-gray-500">Date</label><input className="form-input bg-gray-50" name="date" value={formData.date} readOnly /></div>
                                </div>
                            </Section>

                            {mode === 'payslip' && (
                                <Section title="Financial Details" icon={DollarSign} isOpen={openSection === "financial"} onToggle={() => setOpenSection(openSection === "financial" ? null : "financial")}>
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-2 gap-2">
                                            <div><label className="text-xs font-bold text-gray-500">Gross Salary</label><input className="form-input" type="number" name="salary" value={formData.salary} onChange={handleChange} /></div>
                                            <div><label className="text-xs font-bold text-gray-500">Currency</label><input className="form-input" name="currency" value={formData.currency} onChange={handleChange} /></div>
                                        </div>
                                    </div>
                                </Section>
                            )}

                            <button onClick={handleDownload} disabled={isGenerating} className="w-full bg-blue-600 text-white font-bold py-3 rounded shadow hover:bg-blue-700 flex justify-center items-center gap-2">{isGenerating ? "Processing..." : <><Download size={18} /> Download PDF</>}</button>
                        </div>
                    </div>

                    {/* Preview Area */}
                    <div className="flex-1 bg-gray-100 overflow-y-auto p-4 flex justify-center">
                        <div id="print-area" className="a4-page bg-white text-black flex flex-col relative">
                            <div className={`w-full text-center text-[11px] text-gray-600 font-sans mb-1 font-medium transition-colors duration-500 ${isAiLoading ? 'text-purple-600' : 'text-gray-600'}`}>Employment Verification Letter - <span className="font-bold">{formData.employeeName}</span></div>
                            <div className="flex justify-between items-center border-b border-gray-300 pb-4 mb-6 mt-2 relative">
                                <div className="flex items-center gap-4">
                                    {/* Fallback Logic: Image or Div */}
                                    {!logoLoadError && formData.logoUrl ? (
                                        <img 
                                            src={formData.logoUrl} 
                                            alt="Logo" 
                                            className="h-20 w-20 object-contain" 
                                            crossOrigin="anonymous" 
                                            onError={handleLogoError} 
                                        />
                                    ) : (
                                        <div className="fallback-logo">
                                            {getInitials(formData.schoolName)}
                                        </div>
                                    )}
                                    <div>
                                        <h1 className="text-xl font-bold uppercase tracking-tight text-gray-800 flex items-center gap-2">{formData.schoolName} {verificationStatus === "success" && <span className="bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded-full border border-green-300 no-print">‚úì Verified</span>}</h1>
                                        <p className="text-xs text-gray-500 max-w-sm">{formData.schoolAddress}</p>
                                    </div>
                                </div>
                                {mode === 'payslip' && <div className="text-right"><h2 className="text-lg font-bold text-gray-400 uppercase tracking-widest">EARNINGS STATEMENT</h2></div>}
                            </div>

                            {mode === 'payslip' && (
                                <div className="font-sans text-xs">
                                    <div className={`adp-box transition-all duration-500 ${verificationStatus === 'success' ? 'ring-2 ring-green-400 ring-opacity-50' : ''}`}>
                                        <div className="adp-header"><span>Period: {formData.payPeriodStart} - {formData.payPeriodEnd}</span><span>Pay Date: {formData.payDate}</span></div>
                                        <div className="adp-content flex justify-between"><div className="w-1/3"><p className="font-bold text-gray-800">{formData.schoolName}</p><p className="text-gray-500">{formData.schoolAddress}</p></div><div className="w-1/3 text-center"><p className="text-gray-500">Advice No.</p><p className="font-mono">{formData.checkNumber}</p></div><div className="w-1/3 text-right"><p className="font-bold text-gray-800">{formData.employeeName}</p><p className="text-gray-500">{formData.address}</p><p className="text-gray-500">ID: {formData.employeeId}</p></div></div>
                                    </div>
                                    <div className="flex gap-4 mb-4">
                                        <div className="w-1/2 adp-box">
                                            <div className="adp-header">Earnings</div>
                                            <div className="adp-content"><table className="adp-table"><thead><tr><th>Description</th><th className="text-right">Amount</th></tr></thead><tbody><tr><td>Regular Pay</td><td className="text-right">{formData.currency} {grossPay.toFixed(2)}</td></tr><tr><td>Stipend</td><td className="text-right">{formData.currency} 0.00</td></tr></tbody></table></div>
                                        </div>
                                        <div className="w-1/2 adp-box">
                                            <div className="adp-header">Taxes & Deductions</div>
                                            <div className="adp-content"><table className="adp-table"><thead><tr><th>Description</th><th className="text-right">Amount</th></tr></thead><tbody><tr><td>{formData.taxLabel}</td><td className="text-right">{formData.currency} {fedTax}</td></tr><tr><td>Other/Social</td><td className="text-right">{formData.currency} {(parseFloat(socialSecurity) + parseFloat(medicare)).toFixed(2)}</td></tr></tbody></table></div>
                                        </div>
                                    </div>
                                    <div className="adp-box"><div className="adp-header">Summary</div><div className="adp-content flex justify-between font-mono text-[10px] text-gray-600"><div>Gross: {formData.currency} {grossPay.toFixed(2)}</div><div className="font-bold text-black text-lg">Net Pay: {formData.currency} {netPay}</div></div></div>
                                    <div className="mt-8 text-center text-[10px] text-gray-400">
                                        <p>IMPORTANT: RETAIN THIS STATEMENT FOR YOUR RECORDS.</p>
                                        <p>Generated by Payroll Services | {formData.schoolName}</p>
                                    </div>
                                </div>
                            )}

                            {mode === 'letter' && (
                                <div className="letter-font text-base leading-relaxed p-4 pt-0">
                                    <p className="mb-8">{formData.date}</p>
                                    <div className="mb-6"><p>To: {formData.recipientName}</p><p>{formData.recipientDept}</p></div>
                                    <p className="font-bold underline mb-6">RE: Employment Verification for {formData.employeeName}</p>
                                    <p className="mb-4">To Whom It May Concern,</p>
                                    <p className="mb-4 text-justify">This letter serves to officially confirm that <span className="font-bold">{formData.employeeName}</span> is currently employed as a <span className="font-bold">{formData.jobTitle}</span> at <span className="font-bold">{formData.schoolName}</span>.</p>
                                    <p className="mb-12">If you require any further information, please contact our administrative office at {formData.phone}.</p>
                                    <p>Sincerely,</p>
                                    <div className="mt-6 mb-2"><span className="signature-font text-4xl text-blue-900 -rotate-2 inline-block">{formData.principalName}</span></div>
                                    <div className="font-bold"><p>{formData.principalName}</p></div>
                                    <div><p>{formData.principalTitle}</p><p>{formData.schoolName}</p></div>
                                    <div className="absolute bottom-10 left-0 w-full text-center text-[10px] text-gray-400">
                                        <div className="border-t border-gray-200 mx-20 mb-2"></div>
                                        <p>IMPORTANT: RETAIN THIS STATEMENT FOR YOUR RECORDS.</p>
                                        <p>Generated by Payroll Services | {formData.schoolName}</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
