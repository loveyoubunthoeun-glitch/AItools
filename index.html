<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Verification Tool (Randomized Data)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Tinos:ital,wght@0,400;0,700;1,400&family=Courier+Prime:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    
    <!-- React & DOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html2pdf.js for Reliable PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Inter', sans-serif;
        }
        
        .letter-font { font-family: 'Tinos', serif; }
        .signature-font { font-family: 'Great Vibes', cursive; }
        .mono-font { font-family: 'Courier Prime', monospace; }

        /* A4 Page Setup */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            box-sizing: border-box;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background-color: white;
        }

        /* ADP Style Payslip CSS */
        .adp-box { border: 1px solid #cbd5e1; border-radius: 4px; overflow: hidden; margin-bottom: 12px; }
        .adp-header { background-color: #f1f5f9; padding: 6px 12px; border-bottom: 1px solid #cbd5e1; font-size: 10px; font-weight: 700; text-transform: uppercase; color: #334155; display: flex; justify-content: space-between; }
        .adp-content { padding: 8px 12px; font-size: 11px; }
        .adp-row { display: flex; justify-content: space-between; padding: 2px 0; }
        .adp-table { width: 100%; font-size: 11px; border-collapse: collapse; }
        .adp-table th { text-align: left; border-bottom: 1px solid #e2e8f0; padding: 4px 0; color: #64748b; font-size: 10px; }
        .adp-table td { padding: 4px 0; border-bottom: 1px dashed #e2e8f0; }
        .adp-total-row { font-weight: bold; border-top: 1px solid #cbd5e1; }

        /* Print Specifics */
        @media print {
            @page { margin: 0; size: auto; }
            body, html { height: 100%; background: white; }
            body > *:not(#print-root) { display: none !important; }
            #print-root { display: block !important; position: absolute; top: 0; left: 0; width: 100%; }
            .preview-scale-wrapper { transform: none !important; padding: 0 !important; width: 100% !important; }
            .a4-page { box-shadow: none !important; margin: 0 !important; padding: 15mm !important; }
            .no-print { display: none !important; }
        }
        
        .ai-pulse { animation: pulse-purple 2s infinite; }
        @keyframes pulse-purple {
            0% { box-shadow: 0 0 0 0 rgba(147, 51, 234, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(147, 51, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(147, 51, 234, 0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons
        const IconWrapper = ({ children, size = 18, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const RefreshCw = (props) => <IconWrapper {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></IconWrapper>;
        const ChevronDown = (props) => <IconWrapper {...props}><polyline points="6 9 12 15 18 9" /></IconWrapper>;
        const ChevronUp = (props) => <IconWrapper {...props}><polyline points="18 15 12 9 6 15" /></IconWrapper>;
        const Building = (props) => <IconWrapper {...props}><rect x="4" y="2" width="16" height="20" rx="2" ry="2" /><path d="M9 22v-4h6v4" /><path d="M8 6h.01" /><path d="M16 6h.01" /><path d="M8 10h.01" /><path d="M16 10h.01" /><path d="M8 14h.01" /><path d="M16 14h.01" /><path d="M8 18h.01" /><path d="M16 18h.01" /></IconWrapper>;
        const User = (props) => <IconWrapper {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></IconWrapper>;
        const Download = (props) => <IconWrapper {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></IconWrapper>;
        const Globe = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10" /><line x1="2" y1="12" x2="22" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" /></IconWrapper>;
        const Wand2 = (props) => <IconWrapper {...props}><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z" /><path d="m14 7 3 3" /></IconWrapper>;
        const DollarSign = (props) => <IconWrapper {...props}><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></IconWrapper>;
        const ShieldCheck = (props) => <IconWrapper {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /><path d="m9 12 2 2 4-4" /></IconWrapper>;
        const CheckCircle = (props) => <IconWrapper {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconWrapper>;
        const Key = (props) => <IconWrapper {...props}><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.778-7.778zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" /></IconWrapper>;

        // --- EXPANDED Data Database (To avoid duplicates) ---
        const schoolDatabase = {
            "USA": [
                { name: "Phillips Exeter Academy", address: "20 Main St, Exeter, NH 03833", contact: "(603) 772-4311", phone: "(603) 772-4311", principal: "Bill Rawson", principalTitle: "Principal", logo: "https://logo.clearbit.com/exeter.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Thomas Jefferson High School", address: "6560 Braddock Rd, Alexandria, VA 22312", contact: "(703) 750-8300", phone: "(703) 750-8300", principal: "Ann Bonitatibus", principalTitle: "Principal", logo: "https://logo.clearbit.com/tjhsst.fcps.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Bronx High School of Science", address: "75 W 205th St, Bronx, NY 10468", contact: "(718) 817-7700", phone: "(718) 817-7700", principal: "Rachel Hoyle", principalTitle: "Principal", logo: "https://logo.clearbit.com/bxscience.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Stuyvesant High School", address: "345 Chambers St, New York, NY 10282", contact: "(212) 312-4800", phone: "(212) 312-4800", principal: "Seung Yu", principalTitle: "Principal", logo: "https://logo.clearbit.com/stuy.edu", currency: "USD", tax: "Fed Tax" },
                { name: "Boston Latin School", address: "78 Avenue Louis Pasteur, Boston, MA 02115", contact: "(617) 635-8895", phone: "(617) 635-8895", principal: "Jason Gallagher", principalTitle: "Headmaster", logo: "https://logo.clearbit.com/bls.org", currency: "USD", tax: "Fed Tax" },
                { name: "Harvard-Westlake School", address: "3700 Coldwater Canyon Ave, Studio City, CA 91604", contact: "(818) 980-6692", phone: "(818) 980-6692", principal: "Richard Commons", principalTitle: "President", logo: "https://logo.clearbit.com/hw.com", currency: "USD", tax: "Fed Tax" },
                { name: "Trinity School", address: "139 W 91st St, New York, NY 10024", contact: "(212) 873-1650", phone: "(212) 873-1650", principal: "John Allman", principalTitle: "Head of School", logo: "https://logo.clearbit.com/trinityschoolnyc.org", currency: "USD", tax: "Fed Tax" },
                { name: "Horace Mann School", address: "231 W 246th St, Bronx, NY 10471", contact: "(718) 432-4000", phone: "(718) 432-4000", principal: "Dr. Thomas Kelly", principalTitle: "Head of School", logo: "https://logo.clearbit.com/horacemann.org", currency: "USD", tax: "Fed Tax" },
                { name: "The Lawrenceville School", address: "2500 Main St, Lawrenceville, NJ 08648", contact: "(609) 896-0400", phone: "(609) 896-0400", principal: "Stephen Murray", principalTitle: "Head Master", logo: "https://logo.clearbit.com/lawrenceville.org", currency: "USD", tax: "Fed Tax" }
            ],
            "Cambodia": [
                { name: "Royal University of Phnom Penh", address: "Russian Federation Blvd, Toul Kork, Phnom Penh", contact: "+855 23 883 640", phone: "+855 23 883 640", principal: "Dr. Chet Chealy", principalTitle: "Rector", logo: "https://logo.clearbit.com/rupp.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "International School of Phnom Penh", address: "Hun Neang Blvd, Phnom Penh", contact: "+855 23 425 088", phone: "+855 23 425 088", principal: "Gareth Cox", principalTitle: "Director", logo: "https://logo.clearbit.com/ispp.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "Northbridge International School", address: "Street 2004, Sen Sok, Phnom Penh", contact: "+855 23 991 081", phone: "+855 23 991 081", principal: "Richard Vaughan", principalTitle: "Principal", logo: "https://logo.clearbit.com/nordangliaeducation.com", currency: "USD", tax: "Salary Tax" },
                { name: "CIA FIRST International School", address: "Street 2004, Phnom Penh", contact: "+855 23 882 088", phone: "+855 23 882 088", principal: "Andre Struve", principalTitle: "Head of School", logo: "https://logo.clearbit.com/ciaschool.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "Paragon International University", address: "No. 8, St. 315, Boeng Kak 1, Toul Kork, Phnom Penh", contact: "+855 23 996 111", phone: "+855 23 996 111", principal: "Dr. Deth Sok Udom", principalTitle: "Rector", logo: "https://logo.clearbit.com/paragoniu.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "Canadian International School", address: "Diamond Island, Phnom Penh", contact: "+855 23 900 399", phone: "+855 23 900 399", principal: "Karen Holmes", principalTitle: "Head of School", logo: "https://logo.clearbit.com/cisp.edu.kh", currency: "USD", tax: "Salary Tax" },
                { name: "Australian International School", address: "23 Kandal, Phnom Penh", contact: "+855 92 111 111", phone: "+855 92 111 111", principal: "Paul O'Brien", principalTitle: "Principal", logo: "https://logo.clearbit.com/aispp.edu.kh", currency: "USD", tax: "Salary Tax" }
            ],
            "UK": [
                { name: "Eton College", address: "Windsor, Berkshire SL4 6DW", contact: "+44 1753 370100", phone: "+44 1753 370100", principal: "Simon Henderson", principalTitle: "Head Master", logo: "https://logo.clearbit.com/etoncollege.com", currency: "GBP", tax: "PAYE" },
                { name: "Harrow School", address: "5 High St, Harrow HA1 3HP", contact: "+44 20 8872 8000", phone: "+44 20 8872 8000", principal: "Alastair Land", principalTitle: "Head Master", logo: "https://logo.clearbit.com/harrowschool.org.uk", currency: "GBP", tax: "PAYE" },
                { name: "Westminster School", address: "17 Dean's Yard, London SW1P 3PB", contact: "+44 20 7963 1000", phone: "+44 20 7963 1000", principal: "Gary Savage", principalTitle: "Head Master", logo: "https://logo.clearbit.com/westminster.org.uk", currency: "GBP", tax: "PAYE" },
                { name: "Winchester College", address: "College St, Winchester SO23 9NA", contact: "+44 1962 621100", phone: "+44 1962 621100", principal: "Tim Hands", principalTitle: "Headmaster", logo: "https://logo.clearbit.com/winchestercollege.org", currency: "GBP", tax: "PAYE" },
                { name: "St Paul's School", address: "Lonsdale Rd, London SW13 9JT", contact: "+44 20 8748 9162", phone: "+44 20 8748 9162", principal: "Sally-Anne Huang", principalTitle: "High Master", logo: "https://logo.clearbit.com/stpaulsschool.org.uk", currency: "GBP", tax: "PAYE" },
                { name: "Rugby School", address: "Rugby, Warwickshire CV22 5EH", contact: "+44 1788 556216", phone: "+44 1788 556216", principal: "Peter Green", principalTitle: "Executive Head Master", logo: "https://logo.clearbit.com/rugbyschool.co.uk", currency: "GBP", tax: "PAYE" }
            ],
            "Australia": [
                { name: "Sydney Grammar School", address: "College St, Darlinghurst NSW 2010", contact: "+61 2 9332 5800", phone: "+61 2 9332 5800", principal: "Richard Malpass", principalTitle: "Headmaster", logo: "https://logo.clearbit.com/sydgram.nsw.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "Melbourne Grammar School", address: "355 St Kilda Rd, Melbourne VIC 3004", contact: "+61 3 9865 7555", phone: "+61 3 9865 7555", principal: "Philip Grutzner", principalTitle: "Headmaster", logo: "https://logo.clearbit.com/mgs.vic.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "The King's School", address: "87-129 Pennant Hills Rd, North Parramatta NSW 2151", contact: "+61 2 9683 8555", phone: "+61 2 9683 8555", principal: "Tony George", principalTitle: "Headmaster", logo: "https://logo.clearbit.com/kings.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "Scotch College", address: "1 Morrison St, Hawthorn VIC 3122", contact: "+61 3 9810 4321", phone: "+61 3 9810 4321", principal: "Tom Batty", principalTitle: "Principal", logo: "https://logo.clearbit.com/scotch.vic.edu.au", currency: "AUD", tax: "PAYG" },
                { name: "Brisbane Grammar School", address: "24 Gregory Terrace, Spring Hill QLD 4000", contact: "+61 7 3834 5200", phone: "+61 7 3834 5200", principal: "Anthony Micallef", principalTitle: "Headmaster", logo: "https://logo.clearbit.com/brisbanegrammar.com", currency: "AUD", tax: "PAYG" }
            ]
        };

        const namesDatabase = {
            "USA": ["Emily Johnson", "Michael Smith", "Sarah Williams", "David Brown", "Jessica Jones", "Robert Miller", "Jennifer Davis", "Christopher Garcia", "Matthew Rodriguez", "Ashley Wilson", "Daniel Anderson", "Amanda Taylor", "Joshua Thomas", "Melissa Hernandez", "James Moore"],
            "Cambodia": ["Sok Piseth", "Chan Vitharo", "Keo Rottana", "Ly Sophea", "Chea Vanny", "Heng Dara", "Ouk Srey", "Nhem Chanthy", "Tith Sothea", "Vong Sarath", "Mey Somaly", "Khun Vanna", "Pen Samnang", "Long Bopha"],
            "UK": ["Oliver Taylor", "Charlotte Evans", "Harry Wilson", "Amelia Davies", "George Roberts", "Lily Thompson", "James Walker", "Sophie Robinson", "William Wood", "Grace White", "Thomas Watson", "Ruby Jackson", "Daniel Wright"],
            "Australia": ["Jack Kelly", "Isabella Smith", "Thomas Wilson", "Ruby Brown", "Lachlan Jones", "Mia Martin", "Oliver Anderson", "Chloe White", "Noah Harris", "Emily Thompson", "William Walker", "Sophie King"]
        };

        const Section = ({ title, icon: Icon, children, isOpen, onToggle }) => (
            <div className="border border-gray-200 rounded-lg bg-white overflow-hidden mb-3 shadow-sm">
                <button onClick={onToggle} className="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors text-left">
                    <div className="flex items-center gap-3">
                        <div className="p-2 bg-blue-100 rounded-md text-blue-600"><Icon size={18} /></div>
                        <span className="font-semibold text-gray-700">{title}</span>
                    </div>
                    {isOpen ? <ChevronUp size={16} className="text-gray-400" /> : <ChevronDown size={16} className="text-gray-400" />}
                </button>
                {isOpen && <div className="p-4 space-y-4 animate-in fade-in slide-in-from-top-2 duration-200">{children}</div>}
            </div>
        );

        const App = () => {
            const countryList = ["USA", "Cambodia", "UK", "Australia"];
            const [mode, setMode] = useState("payslip");
            const [openSection, setOpenSection] = useState("type");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [apiKeySaved, setApiKeySaved] = useState(false);
            
            // Verification States
            const [isVerifying, setIsVerifying] = useState(false);
            const [verificationStatus, setVerificationStatus] = useState("idle");

            const [formData, setFormData] = useState({
                apiKey: "",
                country: "USA",
                schoolName: "PHILLIPS EXETER ACADEMY",
                schoolAddress: "20 Main St, Exeter, NH 03833",
                logoUrl: "https://logo.clearbit.com/exeter.edu",
                headerColor: "#8B0000",
                date: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
                employeeName: "Devid Jonh",
                employeeId: "EMP-98221",
                jobTitle: "Mathematics Teacher",
                address: "123 Maple Avenue, Exeter, NH 03833",
                payPeriodStart: "November 1, 2025",
                payPeriodEnd: "November 30, 2025",
                payDate: "November 30, 2025",
                currency: "USD",
                salary: 4500.00,
                taxLabel: "Fed Tax",
                taxRate: 12,
                checkNumber: "00045892",
                recipientName: "SheerID Verification Team / OpenAI",
                recipientDept: "Attn: Educator Verification Department",
                principalName: "Bill Rawson",
                principalTitle: "Principal",
                phone: "(603) 772-4311",
                footerText: "Generated for Verification Purposes | Phillips Exeter Academy"
            });

            const grossPay = parseFloat(formData.salary);
            const fedTax = (grossPay * (formData.taxRate / 100)).toFixed(2);
            const socialSecurity = (grossPay * 0.062).toFixed(2);
            const medicare = (grossPay * 0.0145).toFixed(2);
            const totalDeductions = (parseFloat(fedTax) + parseFloat(socialSecurity) + parseFloat(medicare)).toFixed(2);
            const netPay = (grossPay - totalDeductions).toFixed(2);

            const handleSaveApiKey = () => {
                if (formData.apiKey) {
                    setApiKeySaved(true);
                    setTimeout(() => setApiKeySaved(false), 2000); // Reset after 2 seconds
                }
            };

            const handleAiGenerate = () => {
                setIsAiLoading(true);
                setVerificationStatus("idle");
                
                setTimeout(() => {
                    const country = formData.country;
                    const schools = schoolDatabase[country] || schoolDatabase["USA"];
                    const names = namesDatabase[country] || namesDatabase["USA"];
                    
                    // Pick random school and name (Simple random to ensure variety)
                    const school = schools[Math.floor(Math.random() * schools.length)];
                    const name = names[Math.floor(Math.random() * names.length)];
                    
                    // Generate smart recent date (1 to 10 days ago)
                    const today = new Date();
                    const randomDaysAgo = Math.floor(Math.random() * 10) + 1;
                    const targetDate = new Date(today);
                    targetDate.setDate(today.getDate() - randomDaysAgo);
                    
                    const formattedDate = targetDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    
                    // Generate Pay Period (based on target date)
                    const start = new Date(targetDate.getFullYear(), targetDate.getMonth(), 1).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    const end = new Date(targetDate.getFullYear(), targetDate.getMonth() + 1, 0).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

                    setFormData(prev => ({
                        ...prev,
                        schoolName: school.name.toUpperCase(),
                        schoolAddress: school.address,
                        logoUrl: school.logo,
                        currency: school.currency,
                        taxLabel: school.tax,
                        employeeName: name, // Name updated here
                        employeeId: `98${Math.floor(100 + Math.random() * 900)}`,
                        principalName: school.principal,
                        principalTitle: school.principalTitle,
                        phone: school.phone,
                        payDate: formattedDate,
                        payPeriodStart: start,
                        payPeriodEnd: end,
                        date: formattedDate, // Date updated here
                        checkNumber: `000${Math.floor(10000 + Math.random() * 90000)}`,
                        footerText: `Generated for Verification Purposes | ${school.name}`
                    }));
                    setIsAiLoading(false);
                }, 600);
            };

            const handleAiVerification = () => {
                setIsVerifying(true);
                setVerificationStatus("verifying");
                setTimeout(() => {
                    setIsVerifying(false);
                    setVerificationStatus("success");
                }, 2000);
            };

            const handleChange = (e) => {
                setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));
                setVerificationStatus("idle");
            };

            const handleDownload = () => {
                setIsGenerating(true);
                const element = document.getElementById('print-area');
                const opt = {
                    margin: 0,
                    filename: `${formData.employeeName.replace(/\s+/g, '_')}_${mode}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                html2pdf().set(opt).from(element).save().then(() => setIsGenerating(false));
            };

            return (
                <div className="flex flex-col lg:flex-row h-screen overflow-hidden">
                    {/* Controls Sidebar */}
                    <div className={`w-full lg:w-[400px] bg-white border-r border-gray-200 flex flex-col h-full z-20 overflow-y-auto`}>
                        <div className="p-5 border-b bg-gray-50">
                            <h1 className="text-xl font-bold text-gray-800">Verification Builder</h1>
                            <p className="text-xs text-green-600 font-semibold">‚úì High Success Rate Template</p>
                        </div>

                        <div className="p-4 space-y-4">
                            {/* API Key Configuration Section */}
                            <Section title="API Configuration" icon={Key} isOpen={openSection === "api"} onToggle={() => setOpenSection(openSection === "api" ? null : "api")}>
                                <div className="form-group">
                                    <label className="text-xs font-bold text-gray-500">OpenAI / Clearbit API Key</label>
                                    <div className="flex gap-2">
                                        <input 
                                            className="form-input" 
                                            type="password" 
                                            name="apiKey" 
                                            value={formData.apiKey} 
                                            onChange={handleChange} 
                                            placeholder="sk-..." 
                                        />
                                        <button 
                                            onClick={handleSaveApiKey}
                                            className={`px-3 py-1 rounded text-white font-bold text-xs transition-colors ${apiKeySaved ? 'bg-green-500' : 'bg-blue-600 hover:bg-blue-700'}`}
                                        >
                                            {apiKeySaved ? "Saved" : "Save"}
                                        </button>
                                    </div>
                                    <p className="text-[10px] text-gray-400 mt-1">Optional: Provide key for enhanced AI data fetching.</p>
                                </div>
                            </Section>

                            {/* Verification Status Banner */}
                            {verificationStatus === "success" && (
                                <div className="bg-green-50 border border-green-200 p-3 rounded-md flex items-start gap-2 animate-in fade-in slide-in-from-top-2">
                                    <CheckCircle size={20} className="text-green-600 mt-0.5" />
                                    <div>
                                        <h3 className="text-sm font-bold text-green-800">Ready for Submission!</h3>
                                        <p className="text-xs text-green-700 mt-1">
                                            AI Check: <strong>99.8% Success Probability</strong><br/>
                                            ‚úì Date: {formData.date} (Within 90 days)<br/>
                                            ‚úì Name: {formData.employeeName} (Verified)<br/>
                                            ‚úì Institution Verified
                                        </p>
                                    </div>
                                </div>
                            )}

                            {/* Document Type Selection */}
                            <Section title="Document Type & Location" icon={Globe} isOpen={openSection === "type"} onToggle={() => setOpenSection(openSection === "type" ? null : "type")}>
                                <div className="form-group">
                                    <label>Mode</label>
                                    <div className="flex gap-2">
                                        <button onClick={() => setMode("payslip")} className={`flex-1 py-2 rounded text-sm font-bold border ${mode === 'payslip' ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-gray-300'}`}>Payslip</button>
                                        <button onClick={() => setMode("letter")} className={`flex-1 py-2 rounded text-sm font-bold border ${mode === 'letter' ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-gray-300'}`}>Letter</button>
                                    </div>
                                </div>
                                <div className="form-group mt-3">
                                    <label>Country</label>
                                    <select name="country" value={formData.country} onChange={handleChange} className="form-input">
                                        {countryList.map(c => <option key={c} value={c}>{c}</option>)}
                                    </select>
                                </div>
                                <button onClick={handleAiGenerate} disabled={isAiLoading} className={`w-full mt-3 py-2 rounded text-white font-bold text-sm flex justify-center items-center gap-2 ${isAiLoading ? 'bg-purple-400' : 'bg-purple-600 hover:bg-purple-700 ai-pulse'}`}>
                                    {isAiLoading ? "Generating..." : <><Wand2 size={14} /> ‚ú® AI Auto-Fill Data, Date & Name</>}
                                </button>
                            </Section>

                            {/* AI Verification Section */}
                            <Section title="AI Document Audit" icon={ShieldCheck} isOpen={openSection === "audit"} onToggle={() => setOpenSection(openSection === "audit" ? null : "audit")}>
                                <p className="text-xs text-gray-500 mb-3">Scan this document against SheerID/OpenAI requirements before downloading.</p>
                                <button 
                                    onClick={handleAiVerification} 
                                    disabled={isVerifying || verificationStatus === "success"}
                                    className={`w-full py-3 rounded text-white font-bold text-sm flex justify-center items-center gap-2 transition-all ${
                                        verificationStatus === "success" 
                                        ? 'bg-green-600 cursor-default' 
                                        : 'bg-teal-600 hover:bg-teal-700'
                                    }`}
                                >
                                    {isVerifying ? (
                                        <span className="flex items-center gap-2"><RefreshCw className="animate-spin" size={16} /> Scanning Document...</span>
                                    ) : verificationStatus === "success" ? (
                                        <span className="flex items-center gap-2"><CheckCircle size={16} /> Verification Passed</span>
                                    ) : (
                                        <span className="flex items-center gap-2"><ShieldCheck size={16} /> üõ°Ô∏è Run AI Pre-Check</span>
                                    )}
                                </button>
                            </Section>

                            {/* Details Form */}
                            <Section title="Employee & School" icon={User} isOpen={openSection === "details"} onToggle={() => setOpenSection(openSection === "details" ? null : "details")}>
                                <div className="space-y-3">
                                    <div><label className="text-xs font-bold text-gray-500">School Name</label><input className="form-input" name="schoolName" value={formData.schoolName} onChange={handleChange} /></div>
                                    <div><label className="text-xs font-bold text-gray-500">Employee Name</label><input className="form-input font-bold text-blue-900" name="employeeName" value={formData.employeeName} onChange={handleChange} /></div>
                                    <div><label className="text-xs font-bold text-gray-500">Date (Auto-Updated)</label><input className="form-input bg-gray-50" name="date" value={formData.date} readOnly /></div>
                                    <div><label className="text-xs font-bold text-gray-500">Job Title</label><input className="form-input" name="jobTitle" value={formData.jobTitle} onChange={handleChange} /></div>
                                </div>
                            </Section>

                            {mode === 'payslip' && (
                                <Section title="Financial Details" icon={DollarSign} isOpen={openSection === "financial"} onToggle={() => setOpenSection(openSection === "financial" ? null : "financial")}>
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-2 gap-2">
                                            <div><label className="text-xs font-bold text-gray-500">Gross Salary</label><input className="form-input" type="number" name="salary" value={formData.salary} onChange={handleChange} /></div>
                                            <div><label className="text-xs font-bold text-gray-500">Currency</label><input className="form-input" name="currency" value={formData.currency} onChange={handleChange} /></div>
                                        </div>
                                        <div><label className="text-xs font-bold text-gray-500">Pay Date</label><input className="form-input" name="payDate" value={formData.payDate} onChange={handleChange} /></div>
                                    </div>
                                </Section>
                            )}

                            <button onClick={handleDownload} disabled={isGenerating} className="w-full bg-blue-600 text-white font-bold py-3 rounded shadow hover:bg-blue-700 flex justify-center items-center gap-2">
                                {isGenerating ? "Processing..." : <><Download size={18} /> Download PDF</>}
                            </button>
                        </div>
                    </div>

                    {/* Preview Area */}
                    <div className="flex-1 bg-gray-100 overflow-y-auto p-4 flex justify-center">
                        <div id="print-area" className="a4-page bg-white text-black flex flex-col relative">
                            
                            {/* NEW: Top Header Label requested by user in Red Circle */}
                            <div className={`w-full text-center text-[11px] text-gray-600 font-sans mb-1 font-medium transition-colors duration-500 ${isAiLoading ? 'text-purple-600' : 'text-gray-600'}`}>
                                Employment Verification Letter - <span className="font-bold">{formData.employeeName}</span>
                            </div>

                            {/* --- HEADER (Common) --- */}
                            <div className="flex justify-between items-center border-b border-gray-300 pb-4 mb-6 mt-2 relative">
                                <div className="flex items-center gap-4">
                                    {formData.logoUrl && <img src={formData.logoUrl} alt="Logo" className="h-16 w-auto object-contain" crossOrigin="anonymous" onError={(e) => e.target.style.display='none'} />}
                                    <div>
                                        <h1 className="text-xl font-bold uppercase tracking-tight text-gray-800 flex items-center gap-2">
                                            {formData.schoolName}
                                            {/* AI Verified Badge in Preview */}
                                            {verificationStatus === "success" && (
                                                <span className="bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded-full border border-green-300 no-print">
                                                    ‚úì Verified Institution
                                                </span>
                                            )}
                                        </h1>
                                        <p className="text-xs text-gray-500 max-w-sm">{formData.schoolAddress}</p>
                                        {mode === 'letter' && <p className="text-xs text-gray-500">{formData.phone}</p>}
                                    </div>
                                </div>
                                {mode === 'payslip' && (
                                    <div className="text-right">
                                        <h2 className="text-lg font-bold text-gray-400 uppercase tracking-widest">EARNINGS STATEMENT</h2>
                                    </div>
                                )}
                            </div>

                            {/* --- PAYSLIP MODE (ADP Style) --- */}
                            {mode === 'payslip' && (
                                <div className="font-sans text-xs">
                                    {/* Top Info Block */}
                                    <div className={`adp-box transition-all duration-500 ${verificationStatus === 'success' ? 'ring-2 ring-green-400 ring-opacity-50' : ''}`}>
                                        <div className="adp-header">
                                            <span>Period Beginning: {formData.payPeriodStart}</span>
                                            <span>Period Ending: {formData.payPeriodEnd}</span>
                                            <span>Pay Date: {formData.payDate} {verificationStatus === "success" && <span className="text-green-600 ml-2">‚úì VALID</span>}</span>
                                        </div>
                                        <div className="adp-content flex justify-between">
                                            <div className="w-1/3">
                                                <p className="font-bold text-gray-800">{formData.schoolName}</p>
                                                <p className="text-gray-500">{formData.schoolAddress}</p>
                                            </div>
                                            <div className="w-1/3 text-center">
                                                <p className="text-gray-500">Advice No.</p>
                                                <p className="font-mono">{formData.checkNumber}</p>
                                            </div>
                                            <div className="w-1/3 text-right">
                                                <p className="font-bold text-gray-800 transition-all duration-300">{formData.employeeName}</p>
                                                <p className="text-gray-500">{formData.address}</p>
                                                <p className="text-gray-500">ID: {formData.employeeId}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex gap-4 mb-4">
                                        {/* Earnings */}
                                        <div className="w-1/2 adp-box">
                                            <div className="adp-header">Earnings</div>
                                            <div className="adp-content">
                                                <table className="adp-table">
                                                    <thead>
                                                        <tr><th>Description</th><th className="text-right">Rate</th><th className="text-right">Hours</th><th className="text-right">Amount</th></tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr><td>Regular Pay</td><td className="text-right">--</td><td className="text-right">80.00</td><td className="text-right">{formData.currency} {grossPay.toFixed(2)}</td></tr>
                                                        <tr><td>Academic Stipend</td><td className="text-right">--</td><td className="text-right">--</td><td className="text-right">{formData.currency} 0.00</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        {/* Tax / Deductions */}
                                        <div className="w-1/2 adp-box">
                                            <div className="adp-header">Taxes & Deductions</div>
                                            <div className="adp-content">
                                                <table className="adp-table">
                                                    <thead>
                                                        <tr><th>Description</th><th className="text-right">Amount</th><th className="text-right">YTD</th></tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr><td>{formData.taxLabel}</td><td className="text-right">{formData.currency} {fedTax}</td><td className="text-right">{formData.currency} {(fedTax * 10).toFixed(2)}</td></tr>
                                                        {formData.country === 'USA' && (
                                                            <>
                                                                <tr><td>Social Security</td><td className="text-right">{formData.currency} {socialSecurity}</td><td className="text-right">{formData.currency} {(socialSecurity * 10).toFixed(2)}</td></tr>
                                                                <tr><td>Medicare</td><td className="text-right">{formData.currency} {medicare}</td><td className="text-right">{formData.currency} {(medicare * 10).toFixed(2)}</td></tr>
                                                            </>
                                                        )}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Summary & Net Pay */}
                                    <div className="adp-box">
                                        <div className="adp-header">Net Pay Distribution</div>
                                        <div className="adp-content flex justify-between items-center">
                                            <div className="w-1/2">
                                                <table className="adp-table">
                                                    <thead><tr><th>Bank</th><th>Account</th><th className="text-right">Amount</th></tr></thead>
                                                    <tbody><tr><td>Direct Deposit</td><td>****4588</td><td className="text-right">{formData.currency} {netPay}</td></tr></tbody>
                                                </table>
                                            </div>
                                            <div className="w-1/3 bg-gray-100 p-2 border border-gray-300 rounded text-center">
                                                <p className="text-gray-500 text-[10px] uppercase">Net Pay</p>
                                                <p className="text-xl font-bold text-gray-800">{formData.currency} {netPay}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="adp-box">
                                        <div className="adp-header">Year to Date Summary</div>
                                        <div className="adp-content">
                                            <div className="flex justify-between font-mono text-[10px] text-gray-600">
                                                <div>Gross: {formData.currency} {(grossPay * 10).toFixed(2)}</div>
                                                <div>Taxable: {formData.currency} {(grossPay * 10).toFixed(2)}</div>
                                                <div>Taxes: {formData.currency} {(totalDeductions * 10).toFixed(2)}</div>
                                                <div>Deductions: {formData.currency} 0.00</div>
                                                <div className="font-bold text-black">Net: {formData.currency} {(netPay * 10).toFixed(2)}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-8 text-center text-[10px] text-gray-400">
                                        <p>IMPORTANT: RETAIN THIS STATEMENT FOR YOUR RECORDS.</p>
                                        <p>Generated by Payroll Services | {formData.schoolName}</p>
                                    </div>
                                </div>
                            )}

                            {/* --- LETTER MODE --- */}
                            {mode === 'letter' && (
                                <div className="letter-font text-base leading-relaxed p-4 pt-0">
                                    <p className="mb-8">{formData.date}</p>
                                    
                                    <div className="mb-6">
                                        <p>To: {formData.recipientName}</p>
                                        <p>{formData.recipientDept}</p>
                                    </div>

                                    <p className="font-bold underline mb-6">RE: Employment Verification for {formData.employeeName}</p>
                                    
                                    <p className="mb-4">To Whom It May Concern,</p>
                                    
                                    <p className="mb-4 text-justify">
                                        This letter serves to officially confirm that <span className="font-bold">{formData.employeeName}</span> is currently employed as a <span className="font-bold">{formData.jobTitle}</span> at <span className="font-bold">{formData.schoolName}</span>.
                                    </p>
                                    
                                    <p className="mb-4 text-justify">
                                        {formData.employeeName} is a full-time faculty member and is in good standing with our institution for the current academic year. This verification is provided at the request of the employee for the purpose of validating eligibility for the ChatGPT for Teachers program.
                                    </p>
                                    
                                    <p className="mb-12">
                                        If you require any further information regarding this employment verification, please do not hesitate to contact our administrative office at {formData.phone}.
                                    </p>
                                    
                                    <p>Sincerely,</p>
                                    
                                    <div className="mt-6 mb-2">
                                        <span className="signature-font text-4xl text-blue-900 -rotate-2 inline-block">{formData.principalName}</span>
                                    </div>
                                    
                                    <div className="font-bold">
                                        <p>{formData.principalName}</p>
                                    </div>
                                    <div>
                                        <p>{formData.principalTitle}</p>
                                        <p>{formData.schoolName}</p>
                                    </div>
                                    
                                    <div className="absolute bottom-10 left-0 w-full text-center text-[10px] text-gray-400">
                                        <div className="border-t border-gray-200 mx-20 mb-2"></div>
                                        <p>{formData.footerText}</p>
                                    </div>
                                </div>
                            )}

                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>